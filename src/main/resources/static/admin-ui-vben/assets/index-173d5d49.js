import{aq as de,ap as pe,c as ne,ar as A,k as e,ai as fe,d as D,al as me,e4 as ge,n as H,el as he,ea as ye,cU as ve,r as m,em as be,f as k,a6 as ae,C as Ce,b5 as le,at as T,G as Me,o as b,j as $,w as g,D as He,h as L,au as P,az as ke,S as Be,b as se,F as Se,ay as z,l as V,cP as we,q as Fe,v as Oe,x as X,t as Y,af as W,en as Te,aL as Pe,aO as $e,bY as E,a$ as K,s as Q,aw as G,ao as re,d5 as _e,aH as ee,aI as te,B as ie,X as I,bZ as De,d7 as Re,d4 as ce,b8 as Ne,bs as xe}from"./index-84bac5b8.js";import{u as We}from"./useWindowSizeFn-edf59fbd.js";import{a as je,F as Ee}from"./FullscreenOutlined-2d9cb280.js";const ue=Symbol("modal-context");function Ie(a){return pe(a,ue)}function tt(){return de(ue)}const{t:oe}=ne(),Le={open:{type:Boolean},scrollTop:{type:Boolean,default:!0},height:{type:Number},minHeight:{type:Number,default:600},draggable:{type:Boolean,default:!0},centered:{type:Boolean},cancelText:{type:String,default:oe("common.cancelText")},okText:{type:String,default:oe("common.okText")},closeFunc:Function},Z=Object.assign({},Le,{defaultFullscreen:{type:Boolean},canFullscreen:{type:Boolean,default:!0},wrapperFooterOffset:{type:Number,default:0},helpMessage:[String,Array],useWrapper:{type:Boolean,default:!0},loading:{type:Boolean},loadingTip:{type:String},showCancelBtn:{type:Boolean,default:!0},showOkBtn:{type:Boolean,default:!0},wrapperProps:Object,afterClose:Function,bodyStyle:Object,closable:{type:Boolean,default:!0},closeIcon:Object,confirmLoading:{type:Boolean},destroyOnClose:{type:Boolean,default:!0},footer:Object,getContainer:Function,mask:{type:Boolean,default:!0},maskClosable:{type:Boolean,default:!0},keyboard:{type:Boolean,default:!0},maskStyle:Object,okType:{type:String,default:"primary"},okButtonProps:Object,cancelButtonProps:Object,title:{type:String},open:{type:Boolean},width:{type:[String,Number],default:"40%"},wrapClassName:{type:String},zIndex:{type:Number}});function Ae(a){const c=(s,o)=>getComputedStyle(s)[o],i=s=>{if(!s)return;s.setAttribute("data-drag",e(a.draggable));const o=s.querySelector(".ant-modal-header"),t=s.querySelector(".ant-modal");!o||!t||!e(a.draggable)||(o.style.cursor="move",o.onmousedown=r=>{if(!r)return;const d=r.clientX,u=r.clientY,B=document.body.clientWidth,S=document.documentElement.clientHeight,v=t.offsetWidth,p=t.offsetHeight,h=t.offsetLeft,f=B-t.offsetLeft-v,y=t.offsetTop,w=S-t.offsetTop-p,C=c(t,"left"),M=c(t,"top");let R=+C,N=+M;C.includes("%")?(R=+document.body.clientWidth*(+C.replace(/%/g,"")/100),N=+document.body.clientHeight*(+M.replace(/%/g,"")/100)):(R=+C.replace(/px/g,""),N=+M.replace(/px/g,"")),document.onmousemove=function(j){let F=j.clientX-d,O=j.clientY-u;-F>h?F=-h:F>f&&(F=f),-O>y?O=-y:O>w&&(O=w),t.style.cssText+=`;left:${F+R}px;top:${O+N}px;`},document.onmouseup=()=>{document.onmousemove=null,document.onmouseup=null}})},l=()=>{const s=document.querySelectorAll(".ant-modal-wrap");for(const o of Array.from(s)){if(!o)continue;const t=c(o,"display"),r=o.getAttribute("data-drag");t!=="none"&&(r===null||e(a.destroyOnClose))&&i(o)}};A(()=>{!e(a.open)||!e(a.draggable)||fe(()=>{l()},30)})}function qe(a){return typeof a=="function"||Object.prototype.toString.call(a)==="[object Object]"&&!ve(a)}const ze=D({name:"Modal",inheritAttrs:!1,props:Z,emits:["cancel"],setup(a,{slots:c,emit:i}){const{open:l,draggable:s,destroyOnClose:o}=me(a),t=ge();Ae({open:l,destroyOnClose:o,draggable:s});const r=d=>{i("cancel",d)};return()=>{let d;const u={...e(t),...a,onCancel:r};return H(ye,u,qe(d=he(c))?d:{default:()=>[d]})}}}),Ve=["loading-tip"],Xe=D({name:"ModalWrapper",inheritAttrs:!1,__name:"ModalWrapper",props:{loading:{type:Boolean},useWrapper:{type:Boolean,default:!0},modalHeaderHeight:{type:Number,default:57},modalFooterHeight:{type:Number,default:74},minHeight:{type:Number,default:200},height:{type:Number},footerOffset:{type:Number,default:0},open:{type:Boolean},fullScreen:{type:Boolean},loadingTip:{type:String}},emits:["heightChange","extHeight"],setup(a,{expose:c,emit:i}){const l=a,s=i,o=m(null),t=m(null),r=m(0),d=m(0),u=m(0);We(v.bind(null)),be(t,()=>{v()},{attributes:!0,subtree:!0}),Ie({redoModalHeight:v});const B=k(()=>({minHeight:`${l.minHeight}px`,[l.fullScreen?"height":"maxHeight"]:`${e(r)}px`}));A(()=>{l.useWrapper&&v()}),ae(()=>l.fullScreen,p=>{v(),p?d.value=r.value:r.value=d.value}),Ce(()=>{const{modalHeaderHeight:p,modalFooterHeight:h}=l;s("extHeight",p+h)}),le(()=>{});async function S(){T(()=>{const p=e(o);p&&p?.scrollTo?.(0)})}async function v(){if(!l.open)return;const p=e(o);if(!p)return;const h=p.$el.parentElement;if(h){h.style.padding="0",await T();try{const f=h.parentElement&&h.parentElement.parentElement;if(!f)return;const y=getComputedStyle(f).top,w=Number.parseInt(y);let C=window.innerHeight-w*2+(l.footerOffset||0)-l.modalFooterHeight-l.modalHeaderHeight;w<40&&(C-=26),await T();const M=e(t);if(!M)return;await T(),u.value=M.scrollHeight,l.fullScreen?r.value=window.innerHeight-l.modalFooterHeight-l.modalHeaderHeight-28:r.value=l.height?l.height:u.value>C?C:u.value,s("heightChange",e(r))}catch{}}}return c({scrollTop:S}),(p,h)=>{const f=Me("loading");return b(),$(e(Be),{ref_key:"wrapperRef",ref:o,"scroll-height":u.value},{default:g(()=>[He((b(),L("div",{ref_key:"spinRef",ref:t,style:ke(B.value),"loading-tip":a.loadingTip},[P(p.$slots,"default")],12,Ve)),[[f,a.loading]])]),_:3},8,["scroll-height"])}}}),Ye=D({name:"ModalClose",__name:"ModalClose",props:{canFullscreen:{type:Boolean,default:!0},fullScreen:{type:Boolean}},emits:["cancel","fullscreen"],setup(a,{emit:c}){const i=a,l=c,{t:s}=ne(),{prefixCls:o}=se("basic-modal-close"),t=k(()=>[o,`${o}--custom`,{[`${o}--can-full`]:i.canFullscreen}]);function r(u){l("cancel",u)}function d(u){u?.stopPropagation(),u?.preventDefault(),l("fullscreen")}return(u,B)=>(b(),L("div",{class:Fe(t.value)},[a.canFullscreen?(b(),L(Se,{key:0},[a.fullScreen?(b(),$(e(z),{key:0,title:e(s)("component.modal.restore"),placement:"bottom"},{default:g(()=>[H(e(je),{role:"full",onClick:d})]),_:1},8,["title"])):(b(),$(e(z),{key:1,title:e(s)("component.modal.maximize"),placement:"bottom"},{default:g(()=>[H(e(Ee),{role:"close",onClick:d})]),_:1},8,["title"]))],64)):V("",!0),H(e(z),{title:e(s)("component.modal.close"),placement:"bottom"},{default:g(()=>[H(e(we),{onClick:r})]),_:1},8,["title"])],2))}});const Ue=D({name:"BasicModalFooter",__name:"ModalFooter",props:Z,emits:["ok","cancel"],setup(a,{emit:c}){const i=c;function l(o){i("ok",o)}function s(o){i("cancel",o)}return(o,t)=>{const r=Oe("a-button");return b(),L("div",null,[P(o.$slots,"insertFooter"),o.showCancelBtn?(b(),$(r,W({key:0},o.cancelButtonProps,{onClick:s}),{default:g(()=>[X(Y(o.cancelText),1)]),_:1},16)):V("",!0),P(o.$slots,"centerFooter"),o.showOkBtn?(b(),$(r,W({key:1,type:o.okType,loading:o.confirmLoading},o.okButtonProps,{onClick:l}),{default:g(()=>[X(Y(o.okText),1)]),_:1},16,["type","loading"])):V("",!0),P(o.$slots,"appendFooter")])}}}),Ge=D({name:"BasicModalHeader",__name:"ModalHeader",props:{helpMessage:{type:[String,Array]},title:{type:String}},setup(a){return(c,i)=>(b(),$(e(Te),{"help-message":a.helpMessage},{default:g(()=>[X(Y(a.title),1)]),_:1},8,["help-message"]))}});function Ze(a){const c=m(!1),i=k(()=>{const s=e(a.wrapClassName)||"";return e(c)?`fullscreen-modal ${s} `:e(s)});function l(s){s&&s.stopPropagation(),c.value=!e(c)}return{getWrapClassName:i,handleFullScreen:l,fullScreenRef:c}}const Je=D({name:"BasicModal",inheritAttrs:!1,__name:"BasicModal",props:Z,emits:["openChange","heightChange","cancel","ok","register","update:open"],setup(a,{emit:c}){const i=a,l=c,s=Pe(),o=m(!1),t=m(null),r=m(null),{prefixCls:d}=se("basic-modal"),u=m(0),B={setModalProps:R,emitOpen:void 0,redoModalHeight:()=>{T(()=>{e(r)&&e(r).setModalHeight()})}},S=G();S&&l("register",B,S.uid);const v=k(()=>({...i,...e(t)})),{handleFullScreen:p,getWrapClassName:h,fullScreenRef:f}=Ze({modalWrapperRef:r,extHeightRef:u,wrapClassName:$e(v.value,"wrapClassName")}),y=k(()=>({...{...e(v),open:e(o),okButtonProps:void 0,cancelButtonProps:void 0,title:void 0},wrapClassName:e(h)})),w=k(()=>{const n={...s,...e(v),open:e(o)};return n.wrapClassName=`${n?.wrapClassName||""} ${e(h)}`,e(f)?E(n,["height","title"]):E(n,"title")}),C=k(()=>{if(!e(f))return e(y).height});A(()=>{o.value=!!i.open,f.value=!!i.defaultFullscreen}),ae(()=>e(o),n=>{l("openChange",n),l("update:open",n),S&&B.emitOpen?.(n,S.uid),T(()=>{i.scrollTop&&n&&e(r)&&e(r).scrollTop()})},{immediate:!1});async function M(n){if(n?.stopPropagation(),!n.target?.classList?.contains(`${d}-close--custom`)){if(i.closeFunc&&re(i.closeFunc)){const J=await i.closeFunc();o.value=!J;return}o.value=!1,l("cancel",n)}}function R(n){t.value=_e(e(t)||{},n),Reflect.has(n,"open")&&(o.value=!!n.open),Reflect.has(n,"defaultFullscreen")&&(f.value=!!n.defaultFullscreen)}function N(n){l("ok",n)}function j(n){l("heightChange",n)}function F(n){u.value=n}function O(n){i.canFullscreen&&(n.stopPropagation(),p(n))}return(n,J)=>(b(),$(e(ze),W(w.value,{onCancel:M}),K({default:g(()=>[H(Xe,W({ref_key:"modalWrapperRef",ref:r,"use-wrapper":y.value.useWrapper,"footer-offset":n.wrapperFooterOffset,"full-screen":e(f),loading:y.value.loading,"loading-tip":y.value.loadingTip,"min-height":y.value.minHeight,height:C.value,open:o.value,"modal-footer-height":n.footer!==void 0&&!n.footer?0:void 0},e(E)(y.value.wrapperProps,"open","height","modalFooterHeight"),{onExtHeight:F,onHeightChange:j}),{default:g(()=>[P(n.$slots,"default")]),_:3},16,["use-wrapper","footer-offset","full-screen","loading","loading-tip","min-height","height","open","modal-footer-height"])]),_:2},[n.$slots.closeIcon?void 0:{name:"closeIcon",fn:g(()=>[H(Ye,{"can-fullscreen":y.value.canFullscreen,"full-screen":e(f),onCancel:M,onFullscreen:e(p)},null,8,["can-fullscreen","full-screen","onFullscreen"])]),key:"0"},n.$slots.title?void 0:{name:"title",fn:g(()=>[H(Ge,{"help-message":y.value.helpMessage,title:v.value.title,onDblclick:O},null,8,["help-message","title"])]),key:"1"},n.$slots.footer?void 0:{name:"footer",fn:g(()=>[H(Ue,W(w.value,{onOk:N,onCancel:M}),K({_:2},[Q(Object.keys(n.$slots),x=>({name:x,fn:g(q=>[P(n.$slots,x,ee(te(q||{})))])}))]),1040)]),key:"2"},Q(Object.keys(e(E)(n.$slots,"default")),x=>({name:x,fn:g(q=>[P(n.$slots,x,ee(te(q||{})))])}))]),1040))}});const _=ie({}),U=ie({});function ot(){const a=m(null),c=m(!1),i=m(0);function l(t,r){if(!G())throw new Error("useModal() can only be used inside setup() or functional components!");i.value=r,le(()=>{a.value=null,c.value=!1,_[e(i)]=null}),!(e(c)&&Re()&&t===e(a))&&(a.value=t,c.value=!0,t.emitOpen=(d,u)=>{U[u]=d})}const s=()=>{const t=e(a);return t||ce("useModal instance is undefined!"),t},o={setModalProps:t=>{s()?.setModalProps(t)},getOpen:k(()=>U[~~e(i)]),redoModalHeight:()=>{s()?.redoModalHeight?.()},openModal:(t=!0,r,d=!0)=>{if(s()?.setModalProps({open:t}),!r)return;const u=e(i);if(d){_[u]=null,_[u]=I(r);return}De(I(_[u]),I(r))||(_[u]=I(r))},closeModal:()=>{s()?.setModalProps({open:!1})}};return[l,o]}function nt(a){const c=m(null),i=G(),l=m(0),s=()=>{const t=e(c);return t||ce("useModalInner instance is undefined!"),t},o=(t,r)=>{Ne(()=>{c.value=null}),l.value=r,c.value=t,i?.emit("register",t,r)};return A(()=>{const t=_[e(l)];t&&(!a||!re(a)||T(()=>{a(t)}))}),[o,{changeLoading:(t=!0)=>{s()?.setModalProps({loading:t})},getOpen:k(()=>U[~~e(l)]),changeOkLoading:(t=!0)=>{s()?.setModalProps({confirmLoading:t})},closeModal:()=>{s()?.setModalProps({open:!1})},setModalProps:t=>{s()?.setModalProps(t)},redoModalHeight:()=>{const t=s()?.redoModalHeight;t&&t()}}]}const at=xe(Je);export{at as B,nt as a,tt as b,ot as u};
