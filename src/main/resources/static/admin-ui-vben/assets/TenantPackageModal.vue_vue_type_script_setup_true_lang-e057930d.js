import{d as D,c as K,r as s,k as e,o as g,j as I,w as k,n as F,l as L,af as N,y as V}from"./index-2b36f9e3.js";import"./index-238a0b12.js";import"./BasicForm.vue_vue_type_style_index_0_lang-da06c4a7.js";import{a as $,B as E}from"./index-ab29420a.js";import"./sortable.esm-f208c0d8.js";import{u as _}from"./useRender-e7048bde.js";import{D as p,g as v}from"./dict-d92cc9bc.js";import{u as j,_ as q}from"./useForm-2cb760a4.js";import{_ as G}from"./index-d91ebdc0.js";import{a as H,u as W,c as Y}from"./index-d097f7fe.js";import{l as z}from"./index-d8fd8baf.js";import{h as J}from"./tree-08cb0ff7.js";import{w as Q}from"./without-9c0f4416.js";const ue=[{title:"套餐编号",dataIndex:"id",width:100},{title:"套餐名",dataIndex:"name",width:180},{title:"状态",dataIndex:"status",width:180,customRender:({text:o})=>_.renderDict(o,p.COMMON_STATUS)},{title:"备注",dataIndex:"remark",width:180},{title:"创建时间",dataIndex:"createTime",width:180,customRender:({text:o})=>_.renderDate(o)}],pe=[{label:"套餐名",field:"name",component:"Input",colProps:{span:8}},{label:"状态",field:"status",component:"Select",componentProps:{options:v(p.COMMON_STATUS)},colProps:{span:8}},{label:"创建时间",field:"createTime",component:"RangePicker",colProps:{span:8}}],X=[{label:"编号",field:"id",show:!1,component:"Input"},{label:"套餐名",field:"name",required:!0,component:"Input"},{label:"菜单权限",field:"menuIds",slot:"menuIds",component:"Input"},{label:"状态",field:"status",component:"Select",componentProps:{options:v(p.COMMON_STATUS)}}],fe=D({name:"SystemTenantPackageModal",__name:"TenantPackageModal",emits:["success","register"],setup(o,{emit:w}){const y=w,{t:l}=K(),{createMessage:S}=V(),r=s(!0),c=s([]),i=s([]),m=s([]),T=s(1),f=s(new Set),d=s(),[M,{setFieldsValue:P,resetFields:b,validate:C}]=j({labelWidth:120,baseColProps:{span:24},schemas:X,showActionButtonGroup:!1,actionColOptions:{span:23}}),[R,{setModalProps:u,closeModal:x}]=$(async t=>{if(b(),A(),u({confirmLoading:!1}),e(c).length===0){const a=await z();c.value=J(a,"id"),f.value=new Set(a.map(n=>n.parentId))}if(r.value=!!t?.isUpdate,e(r)){const a=await H(t.record.id),n=Q(a.menuIds,...Array.from(f.value));i.value=a.menuIds,a.menuIds=n,await P({...a})}e(d)&&e(d).filterByLevel(T.value)});async function O(){try{const t=await C();t.menuIds=[...i.value,...m.value],u({confirmLoading:!0}),e(r)?await W(t):await Y(t),x(),y("success"),S.success(l("common.saveSuccessText"))}finally{u({confirmLoading:!1})}}function A(){i.value=[],m.value=[]}function U(t,a){Array.isArray(t)&&(i.value=t,m.value=a.halfCheckedKeys)}return(t,a)=>(g(),I(e(E),N(t.$attrs,{title:r.value?e(l)("action.edit"):e(l)("action.create"),onRegister:e(R),onOk:O}),{default:k(()=>[F(e(q),{onRegister:e(M)},{menuIds:k(({model:n,field:h})=>[c.value.length?(g(),I(e(G),{key:0,ref_key:"treeRef",ref:d,checkedKeys:n[h],"onUpdate:checkedKeys":B=>n[h]=B,"tree-data":c.value,"field-names":{title:"name",key:"id"},checkable:"",toolbar:"",search:"","show-strictly-button":!1,selectable:!1,title:"菜单分配",onCheck:U},null,8,["checkedKeys","onUpdate:checkedKeys","tree-data"])):L("",!0)]),_:1},8,["onRegister"])]),_:1},16,["title","onRegister"]))}});export{fe as _,ue as c,pe as s};
