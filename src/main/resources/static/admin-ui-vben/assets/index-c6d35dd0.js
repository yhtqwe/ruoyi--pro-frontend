import{d as j,H as V,z,J as G,r as c,C as H,o as u,h,n as p,w as l,k as a,i as o,F as P,s as k,j as R,y as J}from"./index-84bac5b8.js";import{_ as K}from"./CashierModal.vue_vue_type_script_setup_true_lang-f3b72a86.js";import"./index-1beb4355.js";import"./BasicForm.vue_vue_type_style_index_0_lang-f40c69bb.js";import{u as Z}from"./index-173d5d49.js";import"./sortable.esm-f208c0d8.js";import{u as M}from"./useRender-70a86cea.js";import{D as ee}from"./index-d97670a9.js";import{s as te,g as O}from"./index-ccfba5e7.js";import{P as r,a as D,b as E}from"./systemEnum-a7142728.js";import{u as ae}from"./useDescription-e7cd1424.js";import{C as n}from"./index-855f7ddd.js";import"./index-5c337476.js";import"./index-b9509bee.js";import"./index-2dea95e5.js";import"./index-d2cf1d1c.js";import"./DownOutlined-a8fe79f2.js";import"./isMobile-174ba801.js";import"./index-d4092c42.js";import"./List-9fcea96e.js";import"./CheckOutlined-c0652f6b.js";import"./index-9bf8eb9e.js";import"./eagerComputed-aaf02481.js";import"./index-343834d4.js";import"./fromPairs-e099444b.js";import"./index-81d4b3c0.js";import"./DoubleRightOutlined-1bb4c7eb.js";import"./useBreakpoint-8b027837.js";import"./responsiveObserve-85850b10.js";import"./zh_CN-1ca40490.js";import"./tree-a6f36781.js";import"./debounce-51e23acd.js";import"./scrollTo-b5e908bd.js";import"./operationUnit-d5166b83.js";import"./index-cc732a41.js";import"./dict-5c702769.js";import"./index-831ed906.js";import"./index-3e1b457d.js";import"./get-acbb0bab.js";import"./index-09793f90.js";import"./Col-5c991ea4.js";import"./useFlexGapSupport-7bccf8d7.js";import"./_baseIteratee-de9a7973.js";import"./onMountedOrActivated-78e848f5.js";import"./PlusOutlined-c3a73197.js";import"./index-5d2832e9.js";import"./index-7a2ca6fc.js";import"./copyTextToClipboard-cc995e2b.js";import"./index-723fd4c3.js";import"./useWindowSizeFn-edf59fbd.js";import"./FullscreenOutlined-2d9cb280.js";import"./index-f29e621a.js";import"./index-ee59d2b5.js";const se="/assets/alipay_pc-61b7a901.svg",re="/assets/alipay_wap-c6a2e6a2.svg",oe="/assets/alipay_app-875a278d.svg",ie="/assets/alipay_qr-800e7752.svg",le="/assets/alipay_bar-8e599b0f.svg",ne="/assets/wx_pub-292a170f.svg",ce="/assets/wx_lite-1f244e1b.svg",ue="/assets/wx_app-f72ee4bc.svg",pe="/assets/wx_native-aab2e7e4.svg",me="/assets/wx_bar-78569907.svg",de="/assets/mock-e9f0a039.svg",_e=[{label:"支付单号",field:"id"},{label:"商品标题",field:"subject"},{label:"商品内容",field:"body"},{label:"支付金额",field:"amount",render:m=>M.renderText("￥",Number.parseFloat(m||0/100).toFixed(2))},{label:"创建时间",field:"createTime",render:m=>M.renderDate(m)},{label:"过期时间",field:"expireTime",render:m=>M.renderDate(m)}],ve=[{name:"支付宝 PC 网站支付",icon:se,code:"alipay_pc"},{name:"支付宝 Wap 网站支付",icon:re,code:"alipay_wap"},{name:"支付宝 App 网站支付",icon:oe,code:"alipay_app"},{name:"支付宝扫码支付",icon:ie,code:"alipay_qr"},{name:"支付宝条码支付",icon:le,code:"alipay_bar"}],fe=[{name:"微信公众号支付",icon:ne,code:"wx_pub"},{name:"微信小程序支付",icon:ce,code:"wx_lite"},{name:"微信 App 支付",icon:ue,code:"wx_app"},{name:"微信扫码支付",icon:pe,code:"wx_native"},{name:"微信条码支付",icon:me,code:"wx_bar"}],ye=[{name:"模拟支付",icon:de,code:"mock"}],be={class:"p-4"},ge=o("p",{class:"mb-4 text-lg text-dark-900"}," 选择支付宝支付 ",-1),xe={class:"flex"},we=["src"],Ae=o("p",{class:"mb-4 text-lg text-dark-900"}," 选择微信支付 ",-1),he={class:"flex"},Ce=["src"],Pe=o("p",{class:"mb-4 text-lg text-dark-900"}," 选择其它支付 ",-1),ke={class:"flex"},Re=["src"],Rt=j({__name:"index",setup(m){const W=V(),{query:S}=z(),{close:I}=G(),{createMessage:i}=J(),[$,{openModal:b}]=Z(),U=c(),v=c(!1),g=c(void 0),f=c(0),d=c(void 0),x=c({url:"",title:""}),_=c({channelCode:"",value:"",title:""}),[q]=ae({schema:_e,data:U});function C(e){if(e===r.ALIPAY_BAR.code){_.value={channelCode:e,value:"",title:"“支付宝”条码支付"},b(!0,{type:"barCode",code:_.value});return}if(e===r.WX_BAR.code){_.value={channelCode:e,value:"",title:"“微信”条码支付"},b(!0,{type:"barCode",code:_.value});return}if(e===r.WX_PUB.code){i.error("微信公众号支付：不支持 PC 网站");return}if(e===r.WX_LITE.code){i.error("微信小程序：不支持 PC 网站");return}B(e)}async function B(e){v.value=!0;try{const s={id:f.value,channelCode:e,returnUrl:location.href,...T(e)},t=await te(s);if(t.status===D.SUCCESS.status){w(),i.success("支付成功！"),A("success");return}t.displayMode===E.URL.mode?X(e,t):t.displayMode===E.QR_CODE.mode?F(e,t):t.displayMode===E.APP.mode&&Q(e),Y()}finally{v.value=!1}}function T(e){return e===r.ALIPAY_BAR.code?{channelExtras:{auth_code:_.value.value}}:e===r.WX_BAR.code?{channelExtras:{authCode:_.value.value}}:{}}function X(e,s){location.href=s.displayContent,v.value=!1}function F(e,s){let t="请使用手机浏览器“扫一扫”";e===r.ALIPAY_WAP.code||(e.indexOf("alipay_")===0?t="请使用支付宝“扫一扫”扫码支付":e.indexOf("wx_")===0&&(t="请使用微信“扫一扫”扫码支付")),x.value={title:t,url:s.displayContent},b(!0,{type:"qrCode",code:x.value}),v.value=!1}function Q(e){e===r.ALIPAY_APP.code&&i.error("支付宝 App 支付：无法在网页支付！"),e===r.WX_APP.code&&i.error("微信 App 支付：无法在网页支付！"),v.value=!1}function Y(){g.value||(g.value=setInterval(async()=>{const e=await O(f.value);e.status===D.SUCCESS.status&&(w(),i.success("支付成功！"),A("success")),e.status===D.CLOSED.status&&(w(),i.error("支付已关闭！"),A("close"))},1e3*2))}function w(){x.value={title:"",url:""},b(!0,{type:"qrCode",code:x.value}),clearInterval(g.value),g.value=void 0}function A(e){if(w(),!d.value){I();return}const s=d.value.includes("?")?`${d.value}&payResult=${e}`:`${d.value}?payResult=${e}`;d.value.indexOf("http")===0?location.href=s:(I(),W(s))}async function N(){if(f.value=S.id,d.value=decodeURIComponent(S.returnUrl),!f.value){i.error("未传递支付单号，无法查看对应的支付信息"),A("cancel");return}const e=await O(f.value);U.value=e}return H(async()=>{await N()}),(e,s)=>(u(),h("div",be,[p(a(n),{title:"支付信息"},{default:l(()=>[p(a(ee),{column:3,onRegister:a(q)},null,8,["onRegister"])]),_:1}),p(a(n),{title:"支付",class:"mt-4"},{default:l(()=>[ge,o("div",xe,[(u(!0),h(P,null,k(a(ve),(t,y)=>(u(),R(a(n),{key:y,hoverable:"",class:"mr-2 w-50 cursor-pointer pb-2 pt-2",onClick:L=>C(t.code)},{cover:l(()=>[o("img",{alt:"example",src:t.icon,class:"h-10 w-10"},null,8,we)]),default:l(()=>[p(a(n).Meta,{title:t.name,class:"text-center"},null,8,["title"])]),_:2},1032,["onClick"]))),128))]),Ae,o("div",he,[(u(!0),h(P,null,k(a(fe),(t,y)=>(u(),R(a(n),{key:y,hoverable:"",class:"mr-2 w-50 cursor-pointer pb-2 pt-2",onClick:L=>C(t.code)},{cover:l(()=>[o("img",{alt:"example",src:t.icon,class:"h-10 w-10"},null,8,Ce)]),default:l(()=>[p(a(n).Meta,{title:t.name,class:"text-center"},null,8,["title"])]),_:2},1032,["onClick"]))),128))]),Pe,o("div",ke,[(u(!0),h(P,null,k(a(ye),(t,y)=>(u(),R(a(n),{key:y,hoverable:"",class:"mr-2 w-50 cursor-pointer pb-2 pt-2",onClick:L=>C(t.code)},{cover:l(()=>[o("img",{alt:"example",src:t.icon,class:"h-10 w-10"},null,8,Re)]),default:l(()=>[p(a(n).Meta,{title:t.name,class:"text-center"},null,8,["title"])]),_:2},1032,["onClick"]))),128))])]),_:1}),p(K,{onRegister:a($),onSuccess:B},null,8,["onRegister"])]))}});export{Rt as default};
