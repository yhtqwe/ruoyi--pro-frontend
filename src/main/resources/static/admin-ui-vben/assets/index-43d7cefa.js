import{d as j,H as V,z,J as G,r as c,C as H,o as u,h,n as p,w as n,k as a,i as o,F as P,s as k,j as R,y as J}from"./index-2b36f9e3.js";import{_ as K}from"./CashierModal.vue_vue_type_script_setup_true_lang-7243ce8b.js";import"./index-238a0b12.js";import"./BasicForm.vue_vue_type_style_index_0_lang-da06c4a7.js";import{u as Z}from"./index-ab29420a.js";import"./sortable.esm-f208c0d8.js";import{u as M}from"./useRender-e7048bde.js";import{D as ee}from"./index-a69dfc8a.js";import{s as te,g as O}from"./index-13d3112c.js";import{P as r,a as D,b as E}from"./systemEnum-a7142728.js";import{u as ae}from"./useDescription-296e4c96.js";import{C as l}from"./index-58c879c6.js";import"./index-3178a791.js";import"./index-813f9aca.js";import"./index-dc3889e5.js";import"./index-4ab0c49d.js";import"./DownOutlined-be102a13.js";import"./isMobile-174ba801.js";import"./index-b3ecbe2f.js";import"./List-d7615df5.js";import"./CheckOutlined-e60d17d3.js";import"./index-3486f0c2.js";import"./eagerComputed-3545aecd.js";import"./index-6a82c206.js";import"./fromPairs-e099444b.js";import"./index-824a8a54.js";import"./DoubleRightOutlined-d560994c.js";import"./useBreakpoint-99376be7.js";import"./responsiveObserve-8393ce72.js";import"./zh_CN-1ca40490.js";import"./tree-08cb0ff7.js";import"./debounce-a0a6c5a0.js";import"./scrollTo-b6f1acc0.js";import"./operationUnit-d5166b83.js";import"./index-7ab89d42.js";import"./dict-d92cc9bc.js";import"./index-ad076651.js";import"./index-ff730b8b.js";import"./get-8e17be71.js";import"./index-4842c089.js";import"./Col-e08843cf.js";import"./useFlexGapSupport-de861fb2.js";import"./_baseIteratee-d1ad35b8.js";import"./onMountedOrActivated-957e2f10.js";import"./PlusOutlined-2d004a4a.js";import"./index-e3989e7b.js";import"./index-3483b766.js";import"./copyTextToClipboard-4db710ed.js";import"./index-cc8e0e79.js";import"./useWindowSizeFn-99db3b88.js";import"./FullscreenOutlined-d4fb962a.js";import"./index-23d73b40.js";import"./index-e012061a.js";const se="/admin-ui-vben/assets/alipay_pc-61b7a901.svg",re="/admin-ui-vben/assets/alipay_wap-c6a2e6a2.svg",oe="/admin-ui-vben/assets/alipay_app-875a278d.svg",ie="/admin-ui-vben/assets/alipay_qr-800e7752.svg",ne="/admin-ui-vben/assets/alipay_bar-8e599b0f.svg",le="/admin-ui-vben/assets/wx_pub-292a170f.svg",ce="/admin-ui-vben/assets/wx_lite-1f244e1b.svg",ue="/admin-ui-vben/assets/wx_app-f72ee4bc.svg",pe="/admin-ui-vben/assets/wx_native-aab2e7e4.svg",me="/admin-ui-vben/assets/wx_bar-78569907.svg",de="/admin-ui-vben/assets/mock-e9f0a039.svg",ve=[{label:"支付单号",field:"id"},{label:"商品标题",field:"subject"},{label:"商品内容",field:"body"},{label:"支付金额",field:"amount",render:m=>M.renderText("￥",Number.parseFloat(m||0/100).toFixed(2))},{label:"创建时间",field:"createTime",render:m=>M.renderDate(m)},{label:"过期时间",field:"expireTime",render:m=>M.renderDate(m)}],_e=[{name:"支付宝 PC 网站支付",icon:se,code:"alipay_pc"},{name:"支付宝 Wap 网站支付",icon:re,code:"alipay_wap"},{name:"支付宝 App 网站支付",icon:oe,code:"alipay_app"},{name:"支付宝扫码支付",icon:ie,code:"alipay_qr"},{name:"支付宝条码支付",icon:ne,code:"alipay_bar"}],fe=[{name:"微信公众号支付",icon:le,code:"wx_pub"},{name:"微信小程序支付",icon:ce,code:"wx_lite"},{name:"微信 App 支付",icon:ue,code:"wx_app"},{name:"微信扫码支付",icon:pe,code:"wx_native"},{name:"微信条码支付",icon:me,code:"wx_bar"}],be=[{name:"模拟支付",icon:de,code:"mock"}],ye={class:"p-4"},ge=o("p",{class:"mb-4 text-lg text-dark-900"}," 选择支付宝支付 ",-1),xe={class:"flex"},we=["src"],Ae=o("p",{class:"mb-4 text-lg text-dark-900"}," 选择微信支付 ",-1),he={class:"flex"},Ce=["src"],Pe=o("p",{class:"mb-4 text-lg text-dark-900"}," 选择其它支付 ",-1),ke={class:"flex"},Re=["src"],Rt=j({__name:"index",setup(m){const W=V(),{query:S}=z(),{close:I}=G(),{createMessage:i}=J(),[$,{openModal:y}]=Z(),U=c(),_=c(!1),g=c(void 0),f=c(0),d=c(void 0),x=c({url:"",title:""}),v=c({channelCode:"",value:"",title:""}),[q]=ae({schema:ve,data:U});function C(e){if(e===r.ALIPAY_BAR.code){v.value={channelCode:e,value:"",title:"“支付宝”条码支付"},y(!0,{type:"barCode",code:v.value});return}if(e===r.WX_BAR.code){v.value={channelCode:e,value:"",title:"“微信”条码支付"},y(!0,{type:"barCode",code:v.value});return}if(e===r.WX_PUB.code){i.error("微信公众号支付：不支持 PC 网站");return}if(e===r.WX_LITE.code){i.error("微信小程序：不支持 PC 网站");return}B(e)}async function B(e){_.value=!0;try{const s={id:f.value,channelCode:e,returnUrl:location.href,...T(e)},t=await te(s);if(t.status===D.SUCCESS.status){w(),i.success("支付成功！"),A("success");return}t.displayMode===E.URL.mode?X(e,t):t.displayMode===E.QR_CODE.mode?F(e,t):t.displayMode===E.APP.mode&&Q(e),Y()}finally{_.value=!1}}function T(e){return e===r.ALIPAY_BAR.code?{channelExtras:{auth_code:v.value.value}}:e===r.WX_BAR.code?{channelExtras:{authCode:v.value.value}}:{}}function X(e,s){location.href=s.displayContent,_.value=!1}function F(e,s){let t="请使用手机浏览器“扫一扫”";e===r.ALIPAY_WAP.code||(e.indexOf("alipay_")===0?t="请使用支付宝“扫一扫”扫码支付":e.indexOf("wx_")===0&&(t="请使用微信“扫一扫”扫码支付")),x.value={title:t,url:s.displayContent},y(!0,{type:"qrCode",code:x.value}),_.value=!1}function Q(e){e===r.ALIPAY_APP.code&&i.error("支付宝 App 支付：无法在网页支付！"),e===r.WX_APP.code&&i.error("微信 App 支付：无法在网页支付！"),_.value=!1}function Y(){g.value||(g.value=setInterval(async()=>{const e=await O(f.value);e.status===D.SUCCESS.status&&(w(),i.success("支付成功！"),A("success")),e.status===D.CLOSED.status&&(w(),i.error("支付已关闭！"),A("close"))},1e3*2))}function w(){x.value={title:"",url:""},y(!0,{type:"qrCode",code:x.value}),clearInterval(g.value),g.value=void 0}function A(e){if(w(),!d.value){I();return}const s=d.value.includes("?")?`${d.value}&payResult=${e}`:`${d.value}?payResult=${e}`;d.value.indexOf("http")===0?location.href=s:(I(),W(s))}async function N(){if(f.value=S.id,d.value=decodeURIComponent(S.returnUrl),!f.value){i.error("未传递支付单号，无法查看对应的支付信息"),A("cancel");return}const e=await O(f.value);U.value=e}return H(async()=>{await N()}),(e,s)=>(u(),h("div",ye,[p(a(l),{title:"支付信息"},{default:n(()=>[p(a(ee),{column:3,onRegister:a(q)},null,8,["onRegister"])]),_:1}),p(a(l),{title:"支付",class:"mt-4"},{default:n(()=>[ge,o("div",xe,[(u(!0),h(P,null,k(a(_e),(t,b)=>(u(),R(a(l),{key:b,hoverable:"",class:"mr-2 w-50 cursor-pointer pb-2 pt-2",onClick:L=>C(t.code)},{cover:n(()=>[o("img",{alt:"example",src:t.icon,class:"h-10 w-10"},null,8,we)]),default:n(()=>[p(a(l).Meta,{title:t.name,class:"text-center"},null,8,["title"])]),_:2},1032,["onClick"]))),128))]),Ae,o("div",he,[(u(!0),h(P,null,k(a(fe),(t,b)=>(u(),R(a(l),{key:b,hoverable:"",class:"mr-2 w-50 cursor-pointer pb-2 pt-2",onClick:L=>C(t.code)},{cover:n(()=>[o("img",{alt:"example",src:t.icon,class:"h-10 w-10"},null,8,Ce)]),default:n(()=>[p(a(l).Meta,{title:t.name,class:"text-center"},null,8,["title"])]),_:2},1032,["onClick"]))),128))]),Pe,o("div",ke,[(u(!0),h(P,null,k(a(be),(t,b)=>(u(),R(a(l),{key:b,hoverable:"",class:"mr-2 w-50 cursor-pointer pb-2 pt-2",onClick:L=>C(t.code)},{cover:n(()=>[o("img",{alt:"example",src:t.icon,class:"h-10 w-10"},null,8,Re)]),default:n(()=>[p(a(l).Meta,{title:t.name,class:"text-center"},null,8,["title"])]),_:2},1032,["onClick"]))),128))])]),_:1}),p(K,{onRegister:a($),onSuccess:B},null,8,["onRegister"])]))}});export{Rt as default};
