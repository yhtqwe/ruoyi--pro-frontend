import{a as K,w,m as A}from"./app.data-dc2a1a3d.js";import{L as f,d as M,c as b,r as d,k as n,o as F,j as L,w as S,n as T,af as V,y as k}from"./index-2b36f9e3.js";import{u as B,_ as O}from"./useForm-2cb760a4.js";import"./BasicForm.vue_vue_type_style_index_0_lang-da06c4a7.js";import{a as R,B as U}from"./index-ab29420a.js";import{d as i}from"./systemEnum-a7142728.js";function x(o,p){const l={appId:o,code:p};return f.get({url:"/pay/channel/get",params:l})}function H(o){return f.post({url:"/pay/channel/create",data:o})}function N(o){return f.put({url:"/pay/channel/update",data:o})}const G=M({name:"ChannelModal",__name:"ChannelModal",emits:["success","register"],setup(o,{emit:p}){const l=p,{t:u}=b(),{createMessage:y}=k(),c=d(!0),s=d(i.ALIPAY),[C,{setFieldsValue:g,resetFields:h,validate:v}]=B({labelWidth:120,baseColProps:{span:24},schemas:s.value===i.ALIPAY?K:s.value===i.WECHAT?w:A,showActionButtonGroup:!1,actionColOptions:{span:23}}),[P,{setModalProps:m,closeModal:_}]=R(async t=>{if(h(),m({confirmLoading:!1}),c.value=!!t?.isUpdate,s.value=t.type,n(c)){const r=await x(t.record.id,t.payCode),a=JSON.parse(r.config),e={};s.value===i.ALIPAY?(e.appId=a.appId,e.serverUrl=a.serverUrl,e.signType=a.signType,e.mode=a.mode,e.privateKey=a.privateKey,e.alipayPublicKey=a.alipayPublicKey,e.appCertContent=a.appCertContent,e.alipayPublicCertContent=a.alipayPublicCertContent,e.rootCertContent=a.rootCertContent):s.value===i.WECHAT&&(e.appId=a.appId,e.apiVersion=a.apiVersion,e.mchId=a.mchId,e.mchKey=a.mchKey,e.privateKeyContent=a.privateKeyContent,e.privateCertContent=a.privateCertContent,e.apiV3Key=a.apiV3Key),r.payConfig=e,delete r.config,g({...r})}});async function I(){try{const t=await v();m({confirmLoading:!0}),t.config=JSON.stringify(t.payConfig),n(c)?await N(t):await H(t),_(),l("success"),y.success(u("common.saveSuccessText"))}finally{m({confirmLoading:!1})}}return(t,r)=>(F(),L(n(U),V(t.$attrs,{title:c.value?n(u)("action.edit"):n(u)("action.create"),onRegister:n(P),onOk:I}),{default:S(()=>[T(n(O),{onRegister:n(C)},null,8,["onRegister"])]),_:1},16,["title","onRegister"]))}});export{G as _};
