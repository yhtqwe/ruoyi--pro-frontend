import{b as S}from"./index-0d7a7dcf.js";import{u as _,g as P,a as T,c as R}from"./index-4517c2b7.js";import{b1 as l,R as m,H as k,y as h,d as x,c as B,r as F,k as t,o as O,j as v,w as E,n as L,af as A}from"./index-84bac5b8.js";import"./index-1beb4355.js";import"./BasicForm.vue_vue_type_style_index_0_lang-f40c69bb.js";import{a as G,B as V}from"./index-173d5d49.js";import"./sortable.esm-f208c0d8.js";import{u as s}from"./useRender-70a86cea.js";import{D as c,g as p}from"./dict-5c702769.js";import{S as Y}from"./index-9bf8eb9e.js";import{u as N,_ as $}from"./useForm-9e126d4c.js";const ne=[{title:"编号",dataIndex:"id",defaultHidden:!0,width:100},{title:"流程标识",dataIndex:"key",width:180},{title:"流程名称",dataIndex:"name",width:180,customRender:({record:e})=>l(m,{type:"link",onClick:H.bind(null,e)},()=>e.formName)},{title:"流程分类",dataIndex:"category",width:120,customRender:({text:e})=>s.renderDict(e,c.BPM_MODEL_CATEGORY)},{title:"表单信息",dataIndex:"formType",width:180,customRender:({record:e})=>e.formId?l(m,{type:"link",onClick:f.bind(null,e)},()=>e.formName):e.formCustomCreatePath?l(m,{type:"link",onClick:f.bind(null,e)},()=>e.formCustomCreatePath):s.renderTag("暂无表单")},{title:"创建时间",dataIndex:"createTime",width:180,customRender:({text:e})=>s.renderDate(e)},{title:"最新部署的流程定义",children:[{title:"流程版本",dataIndex:"processDefinition.version",width:160,customRender:({record:e})=>e.processDefinition?s.renderTag(`v${e.processDefinition.version}`):s.renderTag("未部署")},{title:"激活状态",dataIndex:"processDefinition.suspensionState",width:100,customRender:({record:e})=>{if(e.processDefinition)return Reflect.has(e,"suspensionState")||(e.pendingStatus=!1),l(Y,{checked:e.processDefinition.suspensionState===1,checkedChildren:"激活",unCheckedChildren:"挂起",onChange(i){const a=i?0:1,{createMessage:o}=h();_({id:e.id,state:a}).then(()=>{e.status=a,o.success("已成功修改流程状态")}).catch(()=>{o.error("修改流程状态失败")}).finally(()=>{e.pendingStatus=!1})}})}},{title:"部署时间",dataIndex:"processDefinition.deploymentTim",width:180,customRender:({record:e})=>{if(e.processDefinition)return s.renderDate(e.processDefinition.deploymentTime)}}]}],oe=[{label:"流程标识",field:"key",component:"Input",colProps:{span:8}},{label:"流程名称",field:"name",component:"Input",colProps:{span:8}},{label:"流程分类",field:"category",component:"Select",componentProps:{options:p(c.BPM_MODEL_CATEGORY)},colProps:{span:8}}],q=[{label:"编号",field:"id",show:!1,component:"Input"},{label:"流程标识",field:"key",required:!0,component:"Input",dynamicDisabled:({values:e})=>!!e.id},{label:"流程名称",field:"name",required:!0,component:"Input",dynamicDisabled:({values:e})=>!!e.id},{label:"流程分类",field:"category",component:"Select",componentProps:{options:p(c.BPM_MODEL_CATEGORY)}},{label:"流程描述",field:"description",component:"InputTextArea"},{label:"表单类型",field:"formType",component:"Select",ifShow:({values:e})=>!!e.id,componentProps:{options:p(c.BPM_MODEL_FORM_TYPE)}},{label:"流程表单",field:"formId",component:"ApiSelect",ifShow:({values:e})=>!!e.id&&e.formType===10,componentProps:{api:()=>S(),labelField:"name",valueField:"id"}},{label:"表单提交路由",field:"formCustomCreatePath",component:"Input",helpMessage:"自定义表单的提交路径，使用 Vue 的路由地址，例如说：bpm/oa/leave/create",ifShow:({values:e})=>!!e.id&&e.formType===20},{label:"表单查看路由",field:"formCustomViewPath",component:"Input",helpMessage:"自定义表单的查看路径，使用 Vue 的路由地址，例如说：bpm/oa/leave/view",ifShow:({values:e})=>!!e.id&&e.formType===20}];function H(e){}function f(e){e.formType===10||k()({path:e.formCustomCreatePath})}const se=x({name:"ModelForm",__name:"ModelModal",emits:["success","register"],setup(e,{emit:i}){const a=i,{t:o}=B(),{createMessage:g}=h(),r=F(!0),[M,{setFieldsValue:b,resetFields:w,validate:y}]=N({labelWidth:120,baseColProps:{span:24},schemas:q,showActionButtonGroup:!1,actionColOptions:{span:23}}),[C,{setModalProps:d,closeModal:D}]=G(async n=>{if(w(),d({confirmLoading:!1}),r.value=!!n?.isUpdate,t(r)){const u=await P(n.record.id);b({...u})}});async function I(){try{const n=await y();d({confirmLoading:!0}),t(r)?await T(n):await R(n),D(),a("success"),g.success(o("common.saveSuccessText"))}finally{d({confirmLoading:!1})}}return(n,u)=>(O(),v(t(V),A(n.$attrs,{title:r.value?t(o)("action.edit"):t(o)("action.create"),onRegister:t(C),onOk:I}),{default:E(()=>[L(t($),{onRegister:t(M)},null,8,["onRegister"])]),_:1},16,["title","onRegister"]))}});export{se as _,ne as c,oe as s};
