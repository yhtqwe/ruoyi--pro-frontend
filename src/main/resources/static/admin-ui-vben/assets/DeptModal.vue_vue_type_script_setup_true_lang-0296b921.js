import{l as M,g as T,u as D,c as O}from"./index-a79b375d.js";import{g as d}from"./index-0efdcaab.js";import{d as P,c as U,r as C,k as t,o as R,j as k,w as v,n as y,af as F,y as x}from"./index-2b36f9e3.js";import"./index-238a0b12.js";import"./BasicForm.vue_vue_type_style_index_0_lang-da06c4a7.js";import{a as A,B as L}from"./index-ab29420a.js";import"./sortable.esm-f208c0d8.js";import{u as c}from"./useRender-e7048bde.js";import{D as i,g as p}from"./dict-d92cc9bc.js";import{u as N,_ as q}from"./useForm-2cb760a4.js";let m=[];async function B(){m=await d()}await B();const Q=[{title:"部门名称",dataIndex:"name",width:260,align:"left"},{title:"负责人",dataIndex:"leaderUserId",width:120,customRender:({text:e})=>{if(!e)return"未设置";for(const a of m)if(e===a.id)return a.nickname;return`未知【${e}】`}},{title:"排序",dataIndex:"sort",width:60},{title:"状态",dataIndex:"status",width:180,customRender:({text:e})=>c.renderDict(e,i.COMMON_STATUS)},{title:"创建时间",dataIndex:"createTime",width:180,customRender:({text:e})=>c.renderDate(e)}],X=[{label:"部门名称",field:"name",component:"Input",colProps:{span:8}},{label:"状态",field:"status",component:"Select",componentProps:{options:p(i.COMMON_STATUS)},colProps:{span:8}}],$=[{label:"编号",field:"id",show:!1,component:"Input"},{label:"上级部门",field:"parentId",required:!0,component:"ApiTreeSelect",componentProps:{api:()=>M(),parentLabel:"主类目",fieldNames:{label:"name",key:"id",value:"id"},handleTree:"id"}},{label:"部门名称",field:"name",required:!0,component:"Input"},{label:"显示顺序",field:"sort",required:!0,defaultValue:0,component:"InputNumber"},{label:"负责人",field:"leaderUserId",component:"ApiSelect",componentProps:{api:()=>d(),labelField:"nickname",valueField:"id"}},{label:"联系电话",field:"phone",required:!0,rules:[{pattern:/^(?:(?:\+|00)86)?1(?:3[\d]|4[5-79]|5[0-35-9]|6[5-7]|7[0-8]|8[\d]|9[189])\d{8}$/,message:"请输入正确的手机号码",trigger:"blur"}],component:"Input"},{label:"邮箱",field:"email",required:!0,component:"Input"},{label:"部门状态",field:"status",component:"Select",componentProps:{options:p(i.COMMON_STATUS)}}],Z=P({name:"DeptModal",__name:"DeptModal",emits:["success","register"],setup(e,{emit:a}){const u=a,{t:n}=U(),{createMessage:f}=x(),o=C(!0),[g,{setFieldsValue:b,resetFields:h,validate:I}]=N({labelWidth:120,baseColProps:{span:24},schemas:$,showActionButtonGroup:!1,actionColOptions:{span:23}}),[S,{setModalProps:r,closeModal:_}]=A(async s=>{if(h(),r({confirmLoading:!1}),o.value=!!s?.isUpdate,t(o)){const l=await T(s.record.id);b({...l})}});async function w(){try{const s=await I();r({confirmLoading:!0}),t(o)?await D(s):await O(s),_(),u("success"),f.success(n("common.saveSuccessText"))}finally{r({confirmLoading:!1})}}return(s,l)=>(R(),k(t(L),F(s.$attrs,{title:o.value?t(n)("action.edit"):t(n)("action.create"),onRegister:t(S),onOk:w}),{default:v(()=>[y(t(q),{onRegister:t(g)},null,8,["onRegister"])]),_:1},16,["title","onRegister"]))}});export{Z as _,Q as c,X as s};
