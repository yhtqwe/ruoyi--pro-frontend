import{d as C,ba as h,a_ as I,B as L,r as N,fX as W,ar as U,f as p,v as D,o as _,j as E,w as r,i as e,n as l,k as o,x as i,t as c,h as g,F as O,s as P,fW as $}from"./index-2b36f9e3.js";import{P as A}from"./index-f93c02cf.js";import{T as F}from"./index-ad076651.js";import"./onMountedOrActivated-957e2f10.js";import"./useFlexGapSupport-de861fb2.js";import"./useWindowSizeFn-99db3b88.js";import"./useContentViewHeight-919c9809.js";import"./ArrowLeftOutlined-99ce5bb5.js";import"./index-2f252cfc.js";import"./DownOutlined-be102a13.js";import"./index-c74a997a.js";import"./useBreakpoint-99376be7.js";import"./responsiveObserve-8393ce72.js";import"./eagerComputed-3545aecd.js";import"./operationUnit-d5166b83.js";const M={class:"flex"},j={class:"w-1/3 p-4"},J={class:"flex items-center"},R=e("span",{class:"mr-4 text-lg font-medium"}," 连接状态: ",-1),X=e("hr",{class:"my-4"},null,-1),q={class:"flex"},z=e("p",{class:"mt-4 text-lg font-medium"}," 设置 ",-1),G=e("hr",{class:"my-4"},null,-1),H={class:"ml-4 w-2/3 p-4"},K=e("span",{class:"mr-4 text-lg font-medium"}," 消息记录: ",-1),Q=e("hr",{class:"my-4"},null,-1),Y={class:"max-h-80 overflow-auto"},Z={class:"flex items-center"},ee=e("span",{class:"mr-2 font-medium text-primary"},"收到消息:",-1),he=C({name:"InfraWebSocket",__name:"index",setup(te){const x=h.TextArea,b=I(),t=L({sendValue:"",recordList:[]}),d=N(`${"http://127.0.0.1:48080/websocket/message".replace("http","ws")}?userId=${b.getUserInfo.user.id}`),{status:f,data:u,send:k,close:y,open:w}=W(d.value,{autoReconnect:!1,heartbeat:!0});U(()=>{if(u.value)try{const m=JSON.parse(u.value);t.recordList.push(m)}catch{t.recordList.push({res:u.value,id:Math.ceil(Math.random()*1e3),time:new Date().getTime()})}});const a=p(()=>f.value==="OPEN"),T=p(()=>a.value?"success":"red"),S=p(()=>[...t.recordList].reverse());function V(){k(t.sendValue),t.sendValue=""}function B(){a.value?y():w()}return(m,n)=>{const v=D("a-button");return _(),E(o(A),{title:"WebSocket 示例"},{default:r(()=>[e("div",M,[e("div",j,[e("div",J,[R,l(o(F),{color:T.value},{default:r(()=>[i(c(o(f)),1)]),_:1},8,["color"])]),X,e("div",q,[l(o(h),{value:d.value,"onUpdate:value":n[0]||(n[0]=s=>d.value=s),disabled:""},{addonBefore:r(()=>[i(" 服务地址 ")]),_:1},8,["value"]),l(v,{type:a.value?"danger":"primary",onClick:B},{default:r(()=>[i(c(a.value?"关闭连接":"开启连接"),1)]),_:1},8,["type"])]),z,G,l(o(x),{value:t.sendValue,"onUpdate:value":n[1]||(n[1]=s=>t.sendValue=s),placeholder:"需要发送到服务器的内容",disabled:!a.value,"allow-clear":""},null,8,["value","disabled"]),l(v,{type:"primary",block:"",class:"mt-4",disabled:!a.value,onClick:V},{default:r(()=>[i(" 发送 ")]),_:1},8,["disabled"])]),e("div",H,[K,Q,e("div",Y,[e("ul",null,[(_(!0),g(O,null,P(S.value,s=>(_(),g("li",{key:s.time,class:"mt-2"},[e("div",Z,[ee,e("span",null,c(o($)(s.time)),1)]),e("div",null,c(s.res),1)]))),128))])])])])]),_:1})}}});export{he as default};
