import{f as w}from"./index-cd8c5680.js";import{b as M}from"./index-55c4b3e2.js";import{L as a,d as _,c as x,o as k,j as P,w as S,n as R,k as s,af as y,y as F}from"./index-2b36f9e3.js";import"./index-238a0b12.js";import"./BasicForm.vue_vue_type_style_index_0_lang-da06c4a7.js";import{a as q,B as U}from"./index-ab29420a.js";import"./sortable.esm-f208c0d8.js";import{u as o}from"./useRender-e7048bde.js";import{u as v,_ as A}from"./useForm-2cb760a4.js";const W=[{title:"编号",dataIndex:"id",width:100},{title:"用户标识",dataIndex:"openid",width:180},{title:"昵称",dataIndex:"nickname",width:100},{title:"备注",dataIndex:"remark",width:120},{title:"标签",dataIndex:"tagIds",width:180,customRender:({text:e})=>o.renderTags(e)},{title:"订阅状态",dataIndex:"subscribeStatus",width:180,customRender:({text:e})=>o.renderTag(e===0?"已订阅":"未订阅",e===0?"purple":"orange")},{title:"订阅时间",dataIndex:"subscribeTime",width:180,customRender:({text:e})=>o.renderDate(e)}],i=await w(),z=[{label:"公众号",field:"accountId",component:"Select",required:!0,defaultValue:i[0].id,componentProps:{options:i,fieldNames:{label:"name",value:"id"}},colProps:{span:8}},{label:"用户标识",field:"openid",component:"Input",colProps:{span:8}},{label:"昵称",field:"nickname",component:"Input",colProps:{span:8}}],B=[{label:"编号",field:"id",show:!1,component:"Input"},{label:"昵称",field:"nickname",required:!0,component:"Input"},{label:"备注",field:"remark",required:!0,component:"Input"},{label:"标签",field:"tagIds",helpMessage:"在微信公众平台（mp.weixin.qq.com）的菜单 [设置与开发 - 公众号设置 - 基本设置] 中能找到「开发者ID(AppID)」",required:!0,defaultValue:[],component:"ApiSelect",componentProps:{api:()=>M(),labelField:"name",valueField:"tagId",mode:"tags"}}];function T(e){return a.put({url:"/mp/user/update",data:e})}function C(e){return a.get({url:`/mp/user/get?id=${e}`})}function E(e){return a.get({url:"/mp/user/page",params:e})}function J(e){return a.post({url:`/mp/user/sync?accountId=${e}`})}const K=_({name:"MpUserModal",__name:"MpUserModal",emits:["success","register"],setup(e,{emit:l}){const c=l,{t:d}=x(),{createMessage:u}=F(),[p,{setFieldsValue:m,resetFields:f,validate:g}]=v({labelWidth:120,baseColProps:{span:24},schemas:B,showActionButtonGroup:!1,actionColOptions:{span:23}}),[I,{setModalProps:n,closeModal:h}]=q(async t=>{f(),n({confirmLoading:!1});const r=await C(t.record.id);m({...r})});async function b(){try{const t=await g();n({confirmLoading:!0}),await T(t),h(),c("success"),u.success(d("common.saveSuccessText"))}finally{n({confirmLoading:!1})}}return(t,r)=>(k(),P(s(U),y(t.$attrs,{title:"编辑",onRegister:s(I),onOk:b}),{default:S(()=>[R(s(A),{onRegister:s(p)},null,8,["onRegister"])]),_:1},16,["onRegister"]))}});export{K as _,J as a,W as c,E as g,z as s};
