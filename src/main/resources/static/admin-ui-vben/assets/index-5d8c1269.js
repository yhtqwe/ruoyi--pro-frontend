import{fj as Ve,fk as Ye,fl as Xe,fm as We,fn as qe,fo as ze,fp as Ge,fq as oe,fr as Je,aE as Ze,fs as Qe,ft as et,d as le,r as q,ax as tt,c as nt,f as D,a6 as $,o as N,h as P,k as a,au as lt,l as O,j as Z,w as U,x as ue,t as de,en as st,q as fe,n as g,fu as ct,F as V,s as at,ah as R,aH as rt,aI as it,fv as ot,M as z,aA as ut,dW as dt,aK as ft,cZ as ht,b1 as he,bO as te,fw as ye,C as _e,at as yt,b5 as Ee,cU as we,e6 as pt,e7 as kt,aw as gt,B as pe,X as W,cY as xt,bY as St,ao as Q,fx as bt,f8 as Kt,ar as H,fy as vt,el as ke,b6 as Ct,D as ge,E as xe,S as Lt,af as mt,e3 as Se,d6 as At,aD as be,cV as Ke}from"./index-84bac5b8.js";import{f as _t}from"./fromPairs-e099444b.js";import{D as Et}from"./index-5d2832e9.js";import{g as wt}from"./get-acbb0bab.js";import{b as Tt}from"./tree-a6f36781.js";var Bt=200;function Nt(e,n,i,p){var L=-1,x=We,l=!0,o=e.length,S=[],K=n.length;if(!o)return S;i&&(n=Ve(n,Ye(i))),p?(x=qe,l=!1):n.length>=Bt&&(x=ze,l=!1,n=new Xe(n));e:for(;++L<o;){var k=e[L],c=i==null?k:i(k);if(k=p||k!==0?k:0,l&&c===c){for(var u=K;u--;)if(n[u]===c)continue e;S.push(k)}else x(n,c,p)||S.push(k)}return S}var Dt=Ge(function(e,n){return oe(e)?Nt(e,Je(n,1,oe,!0)):[]});const It=Dt,ve=Symbol("wrapperKey"),Ce=Symbol("propKey");function Ft(e,n){if(!Ze(e)||e[Ce])return e;const{values:i,required:p,default:L,type:x,validator:l}=e,o=i||l?S=>{let K=!1,k=[];if(i&&(k=[...i,L],K||=k.includes(S)),l&&(K||=l(S)),!K&&k.length>0){const c=[...new Set(k)].map(u=>JSON.stringify(u)).join(", ");Qe(`Invalid prop: validation failed${n?` for prop "${n}"`:""}. Expected one of [${c}], got value ${JSON.stringify(S)}.`)}return K}:void 0;return{type:typeof x=="object"&&x&&Object.getOwnPropertySymbols(x).includes(ve)&&x?x[ve]:x,required:!!p,default:L,validator:o,[Ce]:!0}}function Mt(e){return _t(Object.entries(e).map(([n,i])=>[n,Ft(i,n)]))}var w=(e=>(e[e.SELECT_ALL=0]="SELECT_ALL",e[e.UN_SELECT_ALL=1]="UN_SELECT_ALL",e[e.EXPAND_ALL=2]="EXPAND_ALL",e[e.UN_EXPAND_ALL=3]="UN_EXPAND_ALL",e[e.CHECK_STRICTLY=4]="CHECK_STRICTLY",e[e.CHECK_UN_STRICTLY=5]="CHECK_UN_STRICTLY",e))(w||{});const Ot=["update:expandedKeys","update:selectedKeys","update:value","change","check","update:searchValue"],$t=Mt({value:{type:[Object,Array]},renderIcon:{type:Function},helpMessage:{type:[String,Array],default:""},title:{type:String,default:""},toolbar:Boolean,search:Boolean,searchValue:{type:String,default:""},checkStrictly:Boolean,clickRowToExpand:{type:Boolean,default:!1},checkable:Boolean,defaultExpandLevel:{type:[String,Number],default:""},defaultExpandAll:Boolean,showStrictlyButton:{type:Boolean,default:!0},fieldNames:{type:Object},treeData:{type:Array},actionList:{type:Array,default:()=>[]},expandedKeys:{type:Array},selectedKeys:{type:Array,default:()=>[]},checkedKeys:{type:[Array,Object],default:()=>[]},beforeRightClick:{type:Function,default:void 0},rightMenuList:{type:Array},filterFn:{type:Function,default:void 0},highlight:{type:[Boolean,String],default:!1},expandOnSearch:Boolean,checkOnSearch:Boolean,selectedOnSearch:Boolean,loading:{type:Boolean,default:!1},treeWrapperClassName:String});function ne(e,n){return n?typeof n=="string"?` ${e}--${n}`:Array.isArray(n)?n.reduce((i,p)=>i+ne(e,p),""):Object.keys(n).reduce((i,p)=>i+(n[p]?ne(e,p):""),""):""}function jt(e){return(n,i)=>(n&&typeof n!="string"&&(i=n,n=""),n=n?`${e}__${n}`:e,`${n}${ne(n,i)}`)}function Te(e){return[jt(`${et}-${e}`)]}const Pt={key:2,class:"flex flex-1 cursor-pointer items-center justify-self-stretch"},Ut=le({__name:"TreeHeader",props:{helpMessage:{type:[String,Array],default:""},title:{type:String,default:""},toolbar:{type:Boolean,default:!1},showStrictlyButton:{type:Boolean,default:!0},checkable:{type:Boolean,default:!1},search:{type:Boolean,default:!1},searchText:{type:String,default:""},checkAll:{type:Function,default:void 0},expandAll:{type:Function,default:void 0}},emits:["strictly-change","search"],setup(e,{emit:n}){const i=e,p=n,L=q(""),[x]=Te("tree-header"),l=tt(),{t:o}=nt(),S=D(()=>["mr-1","w-full",{"ml-5":l.headerTitle||i.title}]),K=D(()=>{const{checkable:t,showStrictlyButton:d}=i,r=[{label:o("component.tree.expandAll"),value:w.EXPAND_ALL},{label:o("component.tree.unExpandAll"),value:w.UN_EXPAND_ALL,divider:t}],f=[{label:o("component.tree.selectAll"),value:w.SELECT_ALL},{label:o("component.tree.unSelectAll"),value:w.UN_SELECT_ALL,divider:t},...r];return d&&f.push({label:o("component.tree.checkStrictly"),value:w.CHECK_STRICTLY},{label:o("component.tree.checkUnStrictly"),value:w.CHECK_UN_STRICTLY}),t?f:r}),k=({key:t})=>{switch(t){case w.SELECT_ALL:i.checkAll?.(!0);break;case w.UN_SELECT_ALL:i.checkAll?.(!1);break;case w.EXPAND_ALL:i.expandAll?.(!0);break;case w.UN_EXPAND_ALL:i.expandAll?.(!1);break;case w.CHECK_STRICTLY:p("strictly-change",!1);break;case w.CHECK_UN_STRICTLY:p("strictly-change",!0);break}};function c(t){p("search",t)}const u=ft(c,200);return $(()=>L.value,t=>{u(t)}),$(()=>i.searchText,t=>{t!==L.value&&(L.value=t)}),(t,d)=>(N(),P("div",{class:fe([a(x)(),"flex items-center px-2 py-1.5"])},[a(l).headerTitle?lt(t.$slots,"headerTitle",{key:0}):O("",!0),!a(l).headerTitle&&t.title?(N(),Z(a(st),{key:1,"help-message":t.helpMessage},{default:U(()=>[ue(de(t.title),1)]),_:1},8,["help-message"])):O("",!0),t.search||t.toolbar?(N(),P("div",Pt,[t.search?(N(),P("div",{key:0,class:fe(S.value)},[g(a(ct),{value:L.value,"onUpdate:value":d[0]||(d[0]=r=>L.value=r),placeholder:a(o)("common.searchText"),"allow-clear":""},null,8,["value","placeholder"])],2)):O("",!0),t.toolbar?(N(),Z(a(dt),{key:1,onClick:d[1]||(d[1]=ut(()=>{},["prevent"]))},{overlay:U(()=>[g(a(R),{onClick:k},{default:U(()=>[(N(!0),P(V,null,at(K.value,r=>(N(),P(V,{key:r.value},[g(a(R).Item,rt(it({key:r.value})),{default:U(()=>[ue(de(r.label),1)]),_:2},1040),r.divider?(N(),Z(a(ot),{key:0})):O("",!0)],64))),128))]),_:1})]),default:U(()=>[g(a(z),{icon:"ion:ellipsis-vertical"})]),_:1})):O("",!0)])):O("",!0)],2))}}),Ht=({icon:e})=>e?ht(e)?he(z,{icon:e,class:"mr-1"}):he(z):null;function Rt(e,n){function i(c){const u=[],t=c||a(e),{key:d,children:r}=a(n);if(!r||!d)return u;for(let f=0;f<t.length;f++){const h=t[f];u.push(h[d]);const b=h[r];b&&b.length&&u.push(...i(b))}return u}function p(c){const u=[],t=c||a(e),{key:d,children:r}=a(n);if(!r||!d)return u;for(let f=0;f<t.length;f++){const h=t[f];h.disabled!==!0&&h.selectable!==!1&&u.push(h[d]);const b=h[r];b&&b.length&&u.push(...p(b))}return u}function L(c,u){const t=[],d=u||a(e),{key:r,children:f}=a(n);if(!f||!r)return t;for(let h=0;h<d.length;h++){const b=d[h],_=b[f];c===b[r]?(t.push(b[r]),_&&_.length&&t.push(...i(_))):_&&_.length&&t.push(...L(c,_))}return t}function x(c,u,t){if(!c)return;const d=t||a(e),{key:r,children:f}=a(n);if(!(!f||!r))for(let h=0;h<d.length;h++){const b=d[h],_=b[f];if(b[r]===c){d[h]={...d[h],...u};break}else _&&_.length&&x(c,u,b[f])}}function l(c=1,u,t=1){if(!c)return[];const d=[],r=u||a(e)||[];for(let f=0;f<r.length;f++){const h=r[f],{key:b,children:_}=a(n),Y=b?h[b]:"",I=_?h[_]:[];d.push(Y),I&&I.length&&t<c&&(t+=1,d.push(...l(c,I,t)))}return d}function o({parentKey:c=null,node:u,push:t="push"}){const d=te(a(e));if(!c){d[t](u),e.value=d;return}const{key:r,children:f}=a(n);!f||!r||(ye(d,h=>{if(h[r]===c)return h[f]=h[f]||[],h[f][t](u),!0}),e.value=d)}function S({parentKey:c=null,list:u,push:t="push"}){const d=te(a(e));if(!(!u||u.length<1))if(c){const{key:r,children:f}=a(n);if(!f||!r)return;ye(d,h=>{if(h[r]===c){h[f]=h[f]||[];for(let b=0;b<u.length;b++)h[f][t](u[b]);return e.value=d,!0}})}else for(let r=0;r<u.length;r++)d[t](u[r])}function K(c,u){if(!c)return;const t=u||a(e),{key:d,children:r}=a(n);if(!(!r||!d))for(let f=0;f<t.length;f++){const h=t[f],b=h[r];if(h[d]===c){t.splice(f,1);break}else b&&b.length&&K(c,h[r])}}function k(c,u,t){if(!c&&c!==0)return null;const d=u||a(e),{key:r,children:f}=a(n);return r?(d.forEach(h=>{if(t?.key||t?.key===0)return t;if(h[r]===c){t=h;return}h[f]&&h[f].length&&(t=k(c,h[f],t))}),t||null):null}return{deleteNodeByKey:K,insertNodeByKey:o,insertNodesByKey:S,filterByLevel:l,updateNodeByKey:x,getAllKeys:i,getChildrenKeys:L,getEnabledKeys:p,getSelectedNode:k}}function Vt(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!we(e)}const ee="context-menu",Yt={width:{type:Number,default:156},customEvent:{type:Object,default:null},styles:{type:Object},showIcon:{type:Boolean,default:!0},axis:{type:Object,default(){return{x:0,y:0}}},items:{type:Array,default(){return[]}}},Le=e=>{const{item:n}=e;return g("span",{class:"inline-block w-full px-4",onClick:e.handler.bind(null,n)},[e.showIcon&&n.icon&&g(z,{class:"mr-2",icon:n.icon},null),g("span",null,[n.label])])},Xt=le({name:"ContextMenu",props:Yt,setup(e){const n=q(null),i=q(!1),p=D(()=>{const{axis:l,items:o,styles:S,width:K}=e,{x:k,y:c}=l||{x:0,y:0},u=(o||[]).length*40,t=K,d=document.body,r=d.clientWidth<k+t?k-t:k,f=d.clientHeight<c+u?c-u:c;return{position:"absolute",width:`${K}px`,left:`${r+1}px`,top:`${f+1}px`,zIndex:9999,...S}});_e(()=>{yt(()=>i.value=!0)}),Ee(()=>{const l=a(n);l&&document.body.removeChild(l)});function L(l,o){const{handler:S,disabled:K}=l;K||(i.value=!1,o?.stopPropagation(),o?.preventDefault(),S?.())}function x(l){return l.filter(S=>!S.hidden).map(S=>{const{disabled:K,label:k,children:c,divider:u=!1}=S,t={item:S,handler:L,showIcon:e.showIcon};return!c||c.length===0?g(V,null,[g(R.Item,{disabled:K,class:`${ee}__item`,key:k},{default:()=>[g(Le,t,null)]}),u?g(Et,{key:`d-${k}`},null):null]):a(i)?g(R.SubMenu,{key:k,disabled:K,popupClassName:`${ee}__popup`},{title:()=>g(Le,t,null),default:()=>x(c)}):null})}return()=>{let l;if(!a(i))return null;const{items:o}=e;return g(R,{inlineIndent:12,mode:"vertical",class:ee,ref:n,style:a(p)},Vt(l=x(o))?l:{default:()=>[l]})}}});const F={domList:[],resolve:()=>{}},Wt=function(e){const{event:n}=e||{};if(n&&n?.preventDefault(),!!pt)return new Promise(i=>{const p=document.body,L=document.createElement("div"),x={};e.styles&&(x.styles=e.styles),e.items&&(x.items=e.items),e.event&&(x.customEvent=n,x.axis={x:n.clientX,y:n.clientY});const l=g(Xt,x);kt(l,L);const o=function(){F.resolve("")};F.domList.push(L);const S=function(){F.domList.forEach(K=>{try{K&&p.removeChild(K)}catch{}}),p.removeEventListener("click",o),p.removeEventListener("scroll",o)};F.resolve=function(K){S(),i(K)},S(),p.appendChild(L),p.addEventListener("click",o),p.addEventListener("scroll",o)})},me=function(){F&&(F.resolve(""),F.domList=[])};function qt(e=!0){return gt()&&e&&Ee(()=>{me()}),[Wt,me]}function Ae(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!we(e)}const en=le({name:"BasicTree",inheritAttrs:!1,props:$t,emits:Ot,setup(e,{attrs:n,slots:i,emit:p,expose:L}){const[x]=Te("tree"),l=pe({checkStrictly:e.checkStrictly,expandedKeys:e.expandedKeys||[],selectedKeys:e.selectedKeys||[],checkedKeys:e.checkedKeys||[]}),o=pe({startSearch:!1,searchText:"",searchData:[]}),S=q([]),[K]=qt(),k=D(()=>{const{fieldNames:s}=e;return{children:"children",title:"title",key:"key",...s}}),{deleteNodeByKey:c,insertNodeByKey:u,insertNodesByKey:t,filterByLevel:d,updateNodeByKey:r,getAllKeys:f,getChildrenKeys:h,getEnabledKeys:b,getSelectedNode:_}=Rt(S,k),Y=D(()=>{const s={blockNode:!0,...n,...e,expandedKeys:l.expandedKeys,selectedKeys:l.selectedKeys,checkedKeys:l.checkedKeys,checkStrictly:l.checkStrictly,fieldNames:a(k),"onUpdate:expandedKeys":y=>{l.expandedKeys=y,p("update:expandedKeys",y)},"onUpdate:selectedKeys":y=>{l.selectedKeys=y,p("update:selectedKeys",y)},onCheck:(y,m)=>{let C=W(l.checkedKeys);if(xt(C)&&o.startSearch){const A=m.node.eventKey;C=It(C,h(A)),m.checked&&C.push(A),l.checkedKeys=C}else l.checkedKeys=y;const v=W(l.checkedKeys);p("update:value",v),p("check",v,m)},onRightClick:Ne};return St(s,"treeData","class")}),I=D(()=>o.startSearch?o.searchData:a(S)),se=D(()=>!I.value||I.value.length===0);function Be(s,y){return!y&&e.renderIcon&&Q(e.renderIcon)?e.renderIcon(s):y}async function Ne({event:s,node:y}){const{rightMenuList:m=[],beforeRightClick:C}=e,v={event:s,items:[]};if(C&&Q(C)){const A=await C(y,s);Array.isArray(A)?v.items=A:Object.assign(v,A)}else v.items=m;v.items?.length&&(v.items=v.items.filter(A=>!A.hidden),K(v))}function X(s){l.expandedKeys=s}function De(){return l.expandedKeys}function ce(s){l.selectedKeys=s}function Ie(){return l.selectedKeys}function ae(s){l.checkedKeys=s}function Fe(){return l.checkedKeys}function re(s){l.checkedKeys=s?b():[],p("check",l.checkedKeys,[])}function G(s){l.expandedKeys=s?f():[]}function Me(s){l.checkStrictly=s}$(()=>e.searchValue,s=>{s!==o.searchText&&(o.searchText=s)},{immediate:!0}),$(()=>e.treeData,s=>{s&&J(o.searchText)});function J(s){if(s!==o.searchText&&(o.searchText=s),p("update:searchValue",s),!s){o.startSearch=!1;return}const{filterFn:y,checkable:m,expandOnSearch:C,checkOnSearch:v,selectedOnSearch:A}=a(e);o.startSearch=!0;const{title:j,key:M}=a(k),T=[];if(o.searchData=bt(a(S),E=>{const B=y?y(s,E,a(k)):E[j]?.includes(s)??!1;return B&&T.push(E[M]),B},a(k)),C){const E=Kt(o.searchData).map(B=>B[M]);E&&E.length&&X(E)}v&&m&&T.length&&ae(T),A&&T.length&&ce(T)}function Oe(s,y){if(!(!e.clickRowToExpand||!y||y.length===0))if(!l.expandedKeys.includes(s))X([...l.expandedKeys,s]);else{const m=[...l.expandedKeys],C=m.findIndex(v=>v===s);C!==-1&&m.splice(C,1),X(m)}}H(()=>{S.value=e.treeData}),_e(()=>{const s=Number.parseInt(e.defaultExpandLevel);s>0?l.expandedKeys=d(s):e.defaultExpandAll&&G(!0)}),H(()=>{l.expandedKeys=e.expandedKeys}),H(()=>{l.selectedKeys=e.selectedKeys}),H(()=>{l.checkedKeys=e.checkedKeys}),$(()=>e.value,()=>{l.checkedKeys=W(e.value||[])},{immediate:!0}),$(()=>l.checkedKeys,()=>{const s=W(l.checkedKeys);p("update:value",s),p("change",s)}),H(()=>{l.checkStrictly=e.checkStrictly});const $e={setExpandedKeys:X,getExpandedKeys:De,setSelectedKeys:ce,getSelectedKeys:Ie,setCheckedKeys:ae,getCheckedKeys:Fe,insertNodeByKey:u,insertNodesByKey:t,deleteNodeByKey:c,updateNodeByKey:r,getSelectedNode:_,checkAll:re,expandAll:G,filterByLevel:s=>{l.expandedKeys=d(s)},setSearchValue:s=>{J(s)},getSearchValue:()=>o.searchText};function je(s){const{actionList:y}=e;if(!(!y||y.length===0))return y.map((m,C)=>{let v=!0;return Q(m.show)?v=m.show?.(s):be(m.show)&&(v=m.show),v?g("span",{key:C,class:x("action")},[m.render(s)]):null})}const Pe=D(()=>{const s=te(I.value);return vt(s,(y,m)=>{const C=o.searchText,{highlight:v}=a(e),{title:A,key:j,children:M}=a(k),T=Be(y,y.icon),E=wt(y,A),B=C?E.indexOf(C):-1,Ue=o.startSearch&&!At(C)&&v&&B!==-1,He=`color: ${be(v)?"#f50":v}`,Re=Ue?g("span",{class:a(Y)?.blockNode?`${x("content")}`:""},[g("span",null,[E.slice(0,B)]),g("span",{style:He},[C]),g("span",null,[E.slice(B+C.length)])]):E,ie=T?g(Ht,{icon:T},null):i.icon?g("span",{class:"mr-1"},[Ke(i,"icon")]):null;return y[A]=g("span",{class:`${x("title")} pl-2`,onClick:Oe.bind(null,y[j],y[M])},[i?.title?g(V,null,[ie,Ke(i,"title",y)]):g(V,null,[ie,Re,g("span",{class:x("actions")},[je(y)])])]),y}),s});return L($e),()=>{let s,y;const{title:m,helpMessage:C,toolbar:v,search:A,checkable:j,showStrictlyButton:M}=e,T=m||v||A||i.headerTitle,E={height:"calc(100% - 38px)"};return g("div",{class:[x(),"h-full",n.class]},[T&&g(Ut,{checkable:j,checkAll:re,expandAll:G,title:m,search:A,toolbar:v,showStrictlyButton:M,helpMessage:C,onStrictlyChange:Me,onSearch:J,searchText:o.searchText},Ae(s=ke(i))?s:{default:()=>[s]}),g(Ct,{wrapperClassName:a(e.treeWrapperClassName),spinning:a(e.loading),tip:"加载中..."},{default:()=>[ge(g(Lt,{style:E},{default:()=>[g(Tt,mt(a(Y),{showIcon:!1,treeData:Pe.value}),Ae(y=ke(i,["title"]))?y:{default:()=>[y]})]}),[[xe,!a(se)]]),ge(g(Se,{image:Se.PRESENTED_IMAGE_SIMPLE,class:"!mt-4"},null),[[xe,a(se)]])]})])}}});export{en as _,Nt as b};
