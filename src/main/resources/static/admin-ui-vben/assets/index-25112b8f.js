import{d as C,ba as h,a_ as I,B as L,r as N,fX as W,ar as U,f as p,v as D,o as _,j as E,w as l,i as e,n as r,k as o,x as c,t as i,h as g,F as O,s as P,fW as $}from"./index-84bac5b8.js";import{P as A}from"./index-501fd3a5.js";import{T as F}from"./index-831ed906.js";import"./onMountedOrActivated-78e848f5.js";import"./useFlexGapSupport-7bccf8d7.js";import"./useWindowSizeFn-edf59fbd.js";import"./useContentViewHeight-ac910085.js";import"./ArrowLeftOutlined-c95cdb4d.js";import"./index-1c73a8ff.js";import"./DownOutlined-a8fe79f2.js";import"./index-e9ab1be6.js";import"./useBreakpoint-8b027837.js";import"./responsiveObserve-85850b10.js";import"./eagerComputed-aaf02481.js";import"./operationUnit-d5166b83.js";const M={class:"flex"},j={class:"w-1/3 p-4"},J={class:"flex items-center"},R=e("span",{class:"mr-4 text-lg font-medium"}," 连接状态: ",-1),X=e("hr",{class:"my-4"},null,-1),q={class:"flex"},z=e("p",{class:"mt-4 text-lg font-medium"}," 设置 ",-1),G=e("hr",{class:"my-4"},null,-1),H={class:"ml-4 w-2/3 p-4"},K=e("span",{class:"mr-4 text-lg font-medium"}," 消息记录: ",-1),Q=e("hr",{class:"my-4"},null,-1),Y={class:"max-h-80 overflow-auto"},Z={class:"flex items-center"},ee=e("span",{class:"mr-2 font-medium text-primary"},"收到消息:",-1),he=C({name:"InfraWebSocket",__name:"index",setup(te){const x=h.TextArea,b=I(),t=L({sendValue:"",recordList:[]}),d=N(`${"http://localhost:48080/websocket/message".replace("http","ws")}?userId=${b.getUserInfo.user.id}`),{status:f,data:u,send:k,close:y,open:w}=W(d.value,{autoReconnect:!1,heartbeat:!0});U(()=>{if(u.value)try{const m=JSON.parse(u.value);t.recordList.push(m)}catch{t.recordList.push({res:u.value,id:Math.ceil(Math.random()*1e3),time:new Date().getTime()})}});const a=p(()=>f.value==="OPEN"),T=p(()=>a.value?"success":"red"),S=p(()=>[...t.recordList].reverse());function V(){k(t.sendValue),t.sendValue=""}function B(){a.value?y():w()}return(m,n)=>{const v=D("a-button");return _(),E(o(A),{title:"WebSocket 示例"},{default:l(()=>[e("div",M,[e("div",j,[e("div",J,[R,r(o(F),{color:T.value},{default:l(()=>[c(i(o(f)),1)]),_:1},8,["color"])]),X,e("div",q,[r(o(h),{value:d.value,"onUpdate:value":n[0]||(n[0]=s=>d.value=s),disabled:""},{addonBefore:l(()=>[c(" 服务地址 ")]),_:1},8,["value"]),r(v,{type:a.value?"danger":"primary",onClick:B},{default:l(()=>[c(i(a.value?"关闭连接":"开启连接"),1)]),_:1},8,["type"])]),z,G,r(o(x),{value:t.sendValue,"onUpdate:value":n[1]||(n[1]=s=>t.sendValue=s),placeholder:"需要发送到服务器的内容",disabled:!a.value,"allow-clear":""},null,8,["value","disabled"]),r(v,{type:"primary",block:"",class:"mt-4",disabled:!a.value,onClick:V},{default:l(()=>[c(" 发送 ")]),_:1},8,["disabled"])]),e("div",H,[K,Q,e("div",Y,[e("ul",null,[(_(!0),g(O,null,P(S.value,s=>(_(),g("li",{key:s.time,class:"mt-2"},[e("div",Z,[ee,e("span",null,i(o($)(s.time)),1)]),e("div",null,i(s.res),1)]))),128))])])])])]),_:1})}}});export{he as default};
